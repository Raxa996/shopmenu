<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Элитное меню Noir</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Montserrat:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <style>
    /* Кнопка "наверх" */
.scroll-top{
  position:fixed; right:24px; bottom:92px; z-index:70;
  width:44px; height:44px; border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  color:#fff; cursor:pointer;
  background:
    radial-gradient(60% 100% at 30% 0%, rgba(255,255,255,.7), rgba(255,255,255,.06) 60%),
    linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.36);
  box-shadow: inset 0 .5px 0 rgba(255,255,255,.6), 0 10px 24px rgba(0,0,0,.35);
  backdrop-filter: blur(8px);
  opacity:0; pointer-events:none; transform:translateY(10px);
  transition:opacity .25s ease, transform .25s ease;
} /* ← вот этой скобки не хватало */

/* Показываем разные контролы (вне .scroll-top) */
.desktop-only { display:inline-flex; }
.mobile-only  { display:none; }

@media (max-width:600px){
  .desktop-only { display:none; }
  .mobile-only  { display:block; }
}

/* дальше — как было */
.scroll-top.show{ opacity:1; pointer-events:auto; transform:none; }
.scroll-top svg{ width:20px; height:20px; }
@media (max-width:600px){ .scroll-top{ right:16px; bottom:80px; } }

/* Свайп-контрол (без лишней закрывающей скобки ниже) */
.swipe-to-cart{ width:100%; max-width:220px; }
.swipe-track{
  position:relative; height:40px; border-radius:999px;
  background:rgba(162,126,244,.14); border:1px solid rgba(162,126,244,.25);
  display:flex; align-items:center; padding:0 12px; overflow:hidden;
}
.swipe-label{ font-size:12px; letter-spacing:.04em; opacity:.8; }
.swipe-handle{
  position:absolute; inset:3px auto 3px 3px; width:34px; border-radius:999px;
  background:linear-gradient(120deg, var(--success) 0%, #3cbfa7 100%);
  box-shadow:0 8px 16px rgba(0,0,0,.25);
  touch-action: pan-y;
  -webkit-user-select:none;
  user-select:none;
}
  /* Показываем разные контролы */
.scroll-top{
  position:fixed; right:24px; bottom:92px; z-index:70;
  width:44px; height:44px; border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  color:#fff; cursor:pointer;
  background:
    radial-gradient(60% 100% at 30% 0%, rgba(255,255,255,.7), rgba(255,255,255,.06) 60%),
    linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.36);
  box-shadow: inset 0 .5px 0 rgba(255,255,255,.6), 0 10px 24px rgba(0,0,0,.35);
  backdrop-filter: blur(8px);
  opacity:0; pointer-events:none; transform:translateY(10px);
  transition:opacity .25s ease, transform .25s ease;
}
.scroll-top.show{ opacity:1; pointer-events:auto; transform:none; }
.scroll-top svg{ width:20px; height:20px; }
@media (max-width:600px){ .scroll-top{ right:16px; bottom:80px; } }

/* Показываем разные контролы */
.desktop-only { display:inline-flex; }
.mobile-only  { display:none; }
@media (max-width:600px){
  .desktop-only { display:none; }
  .mobile-only  { display:block; }
}

/* Свайп-контрол */
.swipe-to-cart{ width:100%; max-width:220px; }
.swipe-track{
  position:relative; height:40px; border-radius:999px;
  background:rgba(162,126,244,.14); border:1px solid rgba(162,126,244,.25);
  display:flex; align-items:center; padding:0 12px; overflow:hidden;
}
.swipe-label{ font-size:12px; letter-spacing:.04em; opacity:.8; }
.swipe-handle{
  position:absolute; inset:3px auto 3px 3px; width:34px; border-radius:999px;
  background:linear-gradient(120deg, var(--success) 0%, #3cbfa7 100%);
  box-shadow:0 8px 16px rgba(0,0,0,.25);
  touch-action: pan-y; /* горизонтальный свайп, вертикальный скролл разрешён */
}

.scroll-top.show{ opacity:1; pointer-events:auto; transform:none; }
.scroll-top svg{ width:20px; height:20px; }
@media (max-width:600px){ .scroll-top{ right:16px; bottom:80px; } }

    /* ── Badges (лейблы) ─────────────────────────────── */
    .badges {
      position: absolute;
      inset: auto auto 0 0;
      /* по умолчанию низ-слева */
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 10px;
      pointer-events: none;
      /* не мешаем кликам по карточке */
    }

    .badges.top-right {
      inset: 8px 8px auto auto;
    }

    /* если нужно вверх-вправо */

    .badge {
      pointer-events: auto;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .04em;
      text-transform: uppercase;
      line-height: 1;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 255, 255, .28);
      color: #fff;
      white-space: nowrap;
      background: linear-gradient(180deg, rgba(255, 255, 255, .20), rgba(255, 255, 255, .06));
      box-shadow: 0 6px 16px rgba(0, 0, 0, .25), inset 0 1px 0 rgba(255, 255, 255, .2);
    }

    /* Нежные акценты по типам (можешь переименовать под себя) */
    .badge--signature {
      border-color: rgba(162, 126, 244, .55);
      background: linear-gradient(180deg, rgba(162, 126, 244, .32), rgba(22, 18, 34, .4));
    }

    .badge--new {
      border-color: rgba(78, 209, 185, .6);
      background: linear-gradient(180deg, rgba(78, 209, 185, .35), rgba(14, 24, 22, .45));
    }

    .badge--limited {
      border-color: rgba(255, 220, 140, .6);
      background: linear-gradient(180deg, rgba(255, 220, 140, .35), rgba(38, 30, 10, .45));
    }

    .badge--hot {
      border-color: rgba(255, 120, 120, .6);
      background: linear-gradient(180deg, rgba(255, 120, 120, .35), rgba(34, 12, 12, .5));
    }

    .badge--vegan {
      border-color: rgba(160, 230, 120, .6);
      background: linear-gradient(180deg, rgba(160, 230, 120, .35), rgba(16, 28, 14, .5));
    }

    /* Бейджи в модалке */
    .badges--modal {
      position: static;
      padding: 0;
      margin: 6px 0 10px;
    }

    /* Категории (чипы) */
    /* === CATEGORY BAR — frosted white chips === */
    .category-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 0 0 18px;
    }

    /* чтобы можно было позиционировать виджет */
    .menu-section {
      position: relative;
    }

    /* контейнер соцсетей в правом верхнем углу */
    .social-head {
      position: absolute;
      top: 22px;
      right: 22px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .social-title {
      padding: 8px 12px;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .92);
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .22), rgba(255, 255, 255, .08));
      border: 1px solid rgba(255, 255, 255, .35);
      backdrop-filter: blur(8px);
    }

    /* кнопки-иконки: «туманное» стекло */
    .soc-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      background:
        radial-gradient(60% 100% at 30% 0%, rgba(255, 255, 255, .7), rgba(255, 255, 255, .06) 60%),
        linear-gradient(180deg, rgba(255, 255, 255, .16), rgba(255, 255, 255, .06));
      border: 1px solid rgba(255, 255, 255, .36);
      box-shadow: inset 0 .5px 0 rgba(255, 255, 255, .6), 0 10px 24px rgba(0, 0, 0, .35);
      backdrop-filter: blur(8px);
      transition: .2s ease;
    }

    .soc-btn svg {
      width: 20px;
      height: 20px;
    }

    .soc-btn:hover {
      transform: translateY(-2px);
    }

    /* фирменные ховеры */
    .soc-btn--wa:hover {
      color: #25D366;
      border-color: rgba(37, 211, 102, .6);
      box-shadow: 0 10px 24px rgba(37, 211, 102, .45);
    }

    .soc-btn--tg:hover {
      color: #2AABEE;
      border-color: rgba(42, 171, 238, .6);
      box-shadow: 0 10px 24px rgba(42, 171, 238, .45);
    }

    .soc-btn--ig:hover {
      color: #fff;
      border-color: rgba(193, 53, 132, .55);
      background: linear-gradient(135deg, #feda75, #fa7e1e, #d62976, #962fbf, #4f5bd5);
      box-shadow: 0 10px 24px rgba(150, 47, 191, .45);
    }

    .soc-btn--tt:hover {
      color: #fff;
      border-color: rgba(37, 244, 238, .55);
      background:
        radial-gradient(60% 100% at 25% 0%, rgba(37, 244, 238, .35), transparent 60%),
        radial-gradient(60% 90% at 75% 100%, rgba(254, 44, 85, .35), transparent 60%),
        linear-gradient(180deg, rgba(255, 255, 255, .16), rgba(255, 255, 255, .06));
      box-shadow: 0 10px 24px rgba(254, 44, 85, .4);
    }

    /* на планшете/мобилке опускаем блок под заголовок */
    @media (max-width: 1024px) {
      .social-head {
        position: static;
        margin: 8px 0 12px;
      }
    }

    /* сам чип (поддерживаем два имени класса на всякий) */
    .cat-chip,
    .cat-btn {
      --fog: rgba(255, 255, 255, .85);
      --fog2: rgba(255, 255, 255, .70);
      --ring: rgba(255, 255, 255, .55);

      position: relative;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--ring);
      color: #0f0f13;
      /* тёмный текст на светлом чипе */
      font-weight: 700;
      letter-spacing: .02em;
      cursor: pointer;

      /* «туман»: два белых градиента + лёгкий blur */
      background:
        linear-gradient(180deg, var(--fog) 0%, var(--fog2) 100%),
        radial-gradient(120% 160% at 0% 0%, rgba(255, 255, 255, .65) 0%, rgba(255, 255, 255, 0) 70%);
      -webkit-backdrop-filter: blur(8px) saturate(120%);
      backdrop-filter: blur(8px) saturate(120%);

      /* чуть объёма */
      box-shadow:
        0 1px 0 rgba(255, 255, 255, .6) inset,
        0 8px 22px rgba(0, 0, 0, .22);

      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    }

    /* лёгкое «блико-стекло» */
    .cat-chip::after,
    .cat-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      background:
        linear-gradient(to bottom right, rgba(255, 255, 255, .65), rgba(255, 255, 255, 0) 60%);
      mix-blend-mode: screen;
    }

    .cat-chip:hover,
    .cat-btn:hover {
      transform: translateY(-1px);
      box-shadow:
        0 1px 0 rgba(255, 255, 255, .75) inset,
        0 12px 28px rgba(0, 0, 0, .28);
      border-color: rgba(255, 255, 255, .8);
    }

    .cat-chip:focus-visible,
    .cat-btn:focus-visible {
      outline: none;
      box-shadow:
        0 0 0 3px rgba(255, 255, 255, .55),
        0 10px 26px rgba(0, 0, 0, .28);
    }

    /* активный чип — чуть ярче, с внутренним свечением */
    .cat-chip.is-active,
    .cat-btn.is-active {
      background:
        linear-gradient(180deg, rgba(255, 255, 255, .98), rgba(255, 255, 255, .86)),
        radial-gradient(120% 160% at 20% 0%, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0) 65%);
      border-color: rgba(255, 255, 255, .95);
      box-shadow:
        0 0 0 2px rgba(255, 255, 255, .55) inset,
        0 12px 30px rgba(0, 0, 0, .28);
    }

    /* если иконки/счётчики внутри чипа — слегка приглушим */
    .cat-chip .muted,
    .cat-btn .muted {
      opacity: .65;
    }

    .cat-chip .count {
      margin-left: 6px;
      opacity: .7;
      font-weight: 600;
      font-size: 12px;
    }

    :root {
      --bg-1: #050507;
      --bg-2: #0f0f13;
      --bg-3: #1a1a24;
      --accent: #a27ef4;
      --accent-soft: rgba(162, 126, 244, 0.35);
      --text-primary: #f5f5fa;
      --text-muted: rgba(231, 231, 240, 0.72);
      --glass: rgba(15, 15, 25, 0.85);
      --border: rgba(138, 138, 170, 0.2);
      --success: #4ed1b9;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Montserrat', sans-serif;
      color: var(--text-primary);
      background: radial-gradient(circle at top, #1b1b27 0%, var(--bg-2) 40%, var(--bg-1) 100%);
      background-attachment: fixed;
    }

    body.modal-open {
      overflow: hidden;
    }

    .page-wrapper {
      padding: 48px 5vw 64px;
      backdrop-filter: blur(6px);
    }

    @media (max-width: 768px) {
      .page-wrapper {
        padding: 32px 20px 48px;
      }
    }

    .hero {
      max-width: 1024px;
      margin: 0 auto 48px;
      text-align: center;
    }

    .hero .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.4em;
      color: var(--accent);
      font-size: 12px;
      font-weight: 500;
      margin: 0 0 12px;
    }

    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: 48px;
      font-weight: 600;
      margin: 0 0 16px;
      letter-spacing: 0.02em;
    }

    .hero .subtitle {
      font-size: 18px;
      line-height: 1.6;
      color: var(--text-muted);
      margin: 0 0 32px;
    }

    .hero .divider {
      width: 160px;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      margin: 0 auto;
    }

    /* Один столбец + центрирование, т.к. боковая корзина скрыта */
    .layout {
      display: grid;
      grid-template-columns: 1fr;
      /* ← было: minmax(0,1fr) 340px */
      gap: 32px;
      align-items: start;
      max-width: 1240px;
      /* можно 1100–1280 по вкусу */
      margin: 0 auto;
      /* центрируем весь блок */
    }


    @media (max-width: 1080px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .menu-section {
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 28px;
      padding: 32px;
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.35);
    }

    @media (max-width: 600px) {
      .menu-section {
        padding: 24px;
        border-radius: 20px;
      }
    }

    .section-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 32px;
    }

    .section-header h2 {
      font-family: 'Playfair Display', serif;
      font-size: 32px;
      margin: 0;
    }

    .section-header p {
      color: var(--text-muted);
      margin: 0;
      max-width: 520px;
      line-height: 1.6;
    }

    .menu-grid {
      
      display: grid;
      gap: 24px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    /* две карточки в ряд на телефонах */
@media (max-width: 560px){
  .menu-grid{
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 14px;
  }
  .menu-card{ min-height: 260px; }
  .card-image{ height: 120px; }
  .card-content{ padding: 14px 12px 16px; }
  .card-content h3{ font-size: 16px; }
  .card-description{ font-size: 12px; }
}

/* очень узкие экраны — снова одна колонка */
@media (max-width: 360px){
  .menu-grid{ grid-template-columns: 1fr; }
}


    .menu-card {
      position: relative;
      overflow: hidden;
      border-radius: 20px;
      background: linear-gradient(160deg, rgba(24, 24, 34, 0.92), rgba(10, 10, 16, 0.88));
      border: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      min-height: 320px;
      transition: transform 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
      cursor: pointer;
    }

    .menu-card:hover {
      transform: translateY(-6px);
      border-color: rgba(162, 126, 244, 0.55);
      box-shadow: 0 18px 28px rgba(0, 0, 0, 0.45);
    }

    .card-image {
      position: relative;
      height: 180px;
      overflow: hidden;
    }

    .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: saturate(0.85) brightness(0.85);
      transition: transform 0.4s ease;
    }

    .menu-card:hover .card-image img {
      transform: scale(1.08);
    }

    .card-gradient {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(5, 5, 8, 0) 0%, rgba(5, 5, 8, 0.72) 80%);
    }

    .card-content {
      padding: 20px 22px 24px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      flex: 1;
    }

    .card-content h3 {
      font-family: 'Playfair Display', serif;
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.01em;
    }

    .card-description {
      margin: 0;
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.04);
      gap: 12px;
    }

    .card-price {
      font-weight: 600;
      font-size: 16px;
      letter-spacing: 0.03em;
    }

    .card-qty-controls {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(162, 126, 244, 0.14);
      border: 1px solid rgba(162, 126, 244, 0.25);
      border-radius: 999px;
      padding: 6px 10px;
    }

    .card-qty-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
      font-size: 18px;
      line-height: 1;
      cursor: pointer;
      transition: background 0.25s ease, transform 0.25s ease;
    }

    .card-qty-btn:hover {
      background: var(--accent);
      transform: translateY(-1px);
    }

    .card-qty-count {
      min-width: 20px;
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .cart-panel {
      position: sticky;
      top: 32px;
      background: rgba(8, 8, 12, 0.9);
      border-radius: 28px;
      border: 1px solid var(--border);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 480px;
    }

    @media (max-width: 1080px) {
      .cart-panel {
        position: relative;
        top: 0;
      }
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px 28px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .cart-header h2 {
      margin: 0;
      font-family: 'Playfair Display', serif;
      font-size: 26px;
    }

    .cart-counter {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
      font-size: 16px;
    }

    .cart-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px 28px 0;
    }

    .cart-empty {
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      padding: 14px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1 1 auto;
      min-width: 0;
    }

    .cart-item-info img {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .cart-item-name {
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      line-height: 1.4;

      /* переносим длинные слова, чтобы не раздвигали строку */
      overflow-wrap: anywhere;
      word-break: break-word;
    }



    .cart-item-price {
      display: block;
      margin-top: 6px;
      color: var(--text-muted);
      font-size: 12px;
    }

    .cart-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cart-controls button {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.25s ease, transform 0.25s ease;
    }

    .cart-controls button:hover {
      background: var(--accent);
      transform: translateY(-1px);
    }

    .cart-quantity {
      min-width: 24px;
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .cart-footer {
      padding: 20px 28px 28px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      gap: 16px;
      background: linear-gradient(180deg, rgba(18, 18, 28, 0.95), rgba(10, 10, 16, 0.95));
    }

    .total {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      letter-spacing: 0.04em;
      font-size: 15px;
    }

    .checkout-button {
      padding: 16px 18px;
      border-radius: 18px;
      border: none;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      cursor: pointer;
      background: linear-gradient(120deg, var(--accent) 0%, #7b5ce9 100%);
      color: var(--text-primary);
      transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
    }

    .checkout-button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .checkout-button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 24px rgba(162, 126, 244, 0.36);
    }

    .checkout-hint {
      margin: 0;
      font-size: 12px;
      line-height: 1.6;
      color: var(--text-muted);
    }

    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      /* центр по вертикали и горизонтали */
      padding: 24px;
      /* чтобы модалка не прилипала к краям */
      background: rgba(3, 3, 6, 0.82);
      backdrop-filter: blur(10px);
      z-index: 40;
    }

    .modal.hidden {
      opacity: 0;
      pointer-events: none;
    }


    .modal.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .modal-dialog {
      width: min(88vw, 720px);
      max-height: calc(100dvh - 48px);
      /* влезает в экран */
      display: flex;
      /* чтобы тело могло скроллиться */
      flex-direction: column;
      border-radius: 28px;
      overflow: hidden;
      background: linear-gradient(160deg, rgba(18, 18, 26, 0.95), rgba(6, 6, 10, 0.94));
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.55);
      position: relative;
      /* чтобы крестик якорился к диалогу, а не к окну */


      /* ВАЖНО: убираем старый translateY(8px) и position: relative */
      transform: none;
      transition: transform 0.35s ease, opacity 0.35s ease;
    }



    .modal.hidden .modal-dialog {
      transform: translateY(40px);
    }

    .modal-image {
      width: 100%;
      height: clamp(220px, 38dvh, 360px);
      object-fit: cover;
      filter: saturate(0.9) brightness(0.9);
      flex: 0 0 auto;
    }

    .modal-body {
      padding: 28px 32px 32px;
      overflow: auto;
      /* прокрутка внутри модалки, если контента много */
    }

    .modal-body {
      padding: 28px 32px 32px;
    }

    .modal-title {
      font-family: 'Playfair Display', serif;
      margin: 0 0 12px;
      font-size: 32px;
      letter-spacing: 0.01em;
    }

    .modal-description {
      margin: 0 0 12px;
      color: var(--text-muted);
      font-size: 15px;
      line-height: 1.7;
    }

    .modal-details {
      margin: 0 0 24px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.82);
      line-height: 1.7;
    }

    .modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
    }

    .modal-price {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: 0.04em;
    }

    .modal-add {
      padding: 16px 24px;
      border-radius: 16px;
      border: none;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      background: linear-gradient(120deg, var(--success) 0%, #3cbfa7 100%);
      color: var(--text-primary);
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    .modal-add:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 24px rgba(78, 209, 185, 0.28);
    }

    .close-button {
      position: absolute;
      top: 12px;
      right: 12px;

      width: 44px;
      height: 44px;
      border-radius: 999px;

      /* видно на светлых фото */
      background: rgba(10, 10, 16, .55);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .7);
      backdrop-filter: blur(6px);

      display: flex;
      align-items: center;
      justify-content: center;

      font-size: 22px;
      line-height: 1;
      cursor: pointer;
      z-index: 5;
      /* поверх картинки */
      transition: background .15s ease, transform .15s ease;
    }

    .close-button:hover {
      background: rgba(10, 10, 16, .75);
      transform: scale(1.04);
    }



    .close-button:hover {
      background: rgba(162, 126, 244, 0.6);
      transform: rotate(90deg);
    }

    .about {
      margin-top: 48px;
      padding: 40px;
      border-radius: 28px;
      background: rgba(9, 9, 14, 0.9);
      border: 1px solid var(--border);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);
    }

    @media (max-width: 600px) {
      .about {
        padding: 28px;
      }
    }

    .about h2 {
      margin: 0 0 16px;
      font-family: 'Playfair Display', serif;
      font-size: 30px;
    }

    .about p {
      margin: 0 0 16px;
      color: var(--text-muted);
      line-height: 1.7;
    }

    .about-details {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .about-card {
      padding: 18px 20px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(14, 14, 20, 0.8);
    }

    .about-card strong {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent);
    }

    .about-card span {
      font-size: 14px;
      color: var(--text-primary);
      line-height: 1.6;
    }

    ::-webkit-scrollbar {
      width: 7px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(10, 10, 16, 0.8);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(162, 126, 244, 0.45);
      border-radius: 12px;
    }

    @media (max-width: 500px) {
      .hero h1 {
        font-size: 36px;
      }

      .modal-dialog {
        border-radius: 22px;
      }

      .modal-image {
        height: 220px;
      }

      .modal-body {
        padding: 24px;
      }
    }

    /* === Cart form (общее для сайдбара и модалки) === */
    .cart-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      /* 2 колонки: Имя | Телефон */
      gap: 12px;
      margin-top: 12px;
    }

    .cart-form .field {
      display: flex;
      flex-direction: column;
    }

    .cart-form .field--full {
      /* Адрес на всю ширину */
      grid-column: 1 / -1;
    }

    .cart-form .field span {
      display: block;
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: .06em;
      margin-bottom: 6px;
    }

    .cart-form .field input,
    .cart-form .field textarea {
      width: 100%;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .14);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text-primary);
      outline: none;
    }

    .cart-form .field textarea {
      min-height: 72px;
      resize: vertical;
    }

    .cart-form .field input::placeholder,
    .cart-form .field textarea::placeholder {
      color: rgba(255, 255, 255, .45);
    }

    .cart-form .field input:focus,
    .cart-form .field textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(162, 126, 244, .18);
    }

    /* разные отступы для двух контейнеров */
    .cart-panel .cart-form {
      padding: 12px 28px 0;
    }

    .cart-dialog .cart-form {
      padding: 12px 0 0;
    }

    /* на телефоне всё в столбик */
    @media (max-width: 600px) {
      .cart-form {
        grid-template-columns: 1fr;
      }
    }

    /* Спрятать боковую панель (по желанию) */
    .cart-panel {
      display: none;
    }

    /* Плавающая мини-корзина */
    .mini-cart {
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 60;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 18px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(120deg, var(--accent) 0%, #7b5ce9 100%);
      color: var(--text-primary);
      font-weight: 700;
      letter-spacing: .06em;
      cursor: pointer;
      box-shadow: 0 14px 24px rgba(162, 126, 244, .36);
    }

    .mini-cart__counter {
      min-width: 32px;
      height: 32px;
      border-radius: 999px;
      background: rgba(0, 0, 0, .25);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
    }

    @media (max-width: 600px) {
      .mini-cart {
        right: 16px;
        bottom: 16px;
        padding: 12px 14px;
      }

      .mini-cart__counter {
        min-width: 28px;
        height: 28px;
      }

      .mini-cart__label {
        font-size: 12px;
      }
    }

    /* Модалка корзины: размеры, список, футер */
    .cart-dialog {
      width: min(92vw, 820px);
    }

    .cart-modal-list {
      max-height: 42vh;
      overflow: auto;
      padding: 8px 0;
    }

    .cart-modal-list .cart-item {
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, .06);
    }

    .cart-modal-list .cart-item:last-child {
      border-bottom: none;
    }

    .cart-dialog__footer {
      margin-top: 12px;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, .08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    /* Переиспользуем стили из обычной корзины — добавим гибкость */
    .cart-item-info {
      flex: 1 1 auto;
      min-width: 0;
      gap: 12px;
    }

    .cart-item-name {
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    /* ======= ПУСТАЯ КОРЗИНА: шейк кнопки + текст ======= */
    @keyframes cart-shake {
      0% {
        transform: translateX(0)
      }

      15% {
        transform: translateX(-6px)
      }

      30% {
        transform: translateX(6px)
      }

      45% {
        transform: translateX(-4px)
      }

      60% {
        transform: translateX(4px)
      }

      75% {
        transform: translateX(-2px)
      }

      100% {
        transform: translateX(0)
      }
    }

    .is-shaking {
      animation: cart-shake .5s ease;
    }

    /* Контейнер справа от суммы: текст ошибки + кнопка */
    .cart-footer-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    /* Текст ошибки под кнопкой */
    .cart-error {
      font-size: 15px;
      color: #ff8d8d;
      opacity: 0;
      transform: translateY(4px);
      transition: .3s ease;
    }

    .cart-error.show {
      opacity: 1;
      transform: none;
    }
    .ghost-button{
  padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.35);
  background:transparent;color:#fff;font-weight:700;letter-spacing:.08em;cursor:pointer;transition:.2s
}
.ghost-button:hover{background:rgba(255,255,255,.08)}
/* Swipe progress + smooth return */
.swipe-track{ --p:0; user-select:none; }
.swipe-track::before{
  content:""; position:absolute; inset:0; z-index:0;
  transform:scaleX(var(--p)); transform-origin:left;
  background:linear-gradient(90deg, rgba(78,209,185,.35), rgba(78,209,185,.12));
  transition:transform .12s ease;
}
.swipe-label{ position:relative; z-index:1; transition:opacity .2s ease, transform .2s ease; }
.swipe-track.added .swipe-label{ opacity:.8; transform:translateX(4px); }
.swipe-handle{ will-change: transform; transition: transform .25s ease; touch-action: pan-y; }

/* === свайп красиво-style: свайп карточек влево/вправо === */
body.card-swipe .swipe-to-cart{ display:none !important; } /* прячем старый ползунок на мобиле */

.menu-card{ position:relative; overflow:hidden; }
.card-swipe-bg{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 16px; pointer-events:none;
  opacity:0; transition:opacity .18s ease;
}
.card-swipe-bg.show{ opacity:1; }
.card-swipe-bg .ok,.card-swipe-bg .ko{
  /* Десктоп: не показывать слой с иконками свайпа */
@media (hover: hover) and (pointer: fine){
  .card-swipe-bg{ display:none !important; }
}

  display:flex; align-items:center; justify-content:center;
  width:56px; height:56px; border-radius:14px; color:#fff;
  box-shadow:0 10px 22px rgba(0,0,0,.28);
}
.card-swipe-bg .ok{ background:linear-gradient(120deg,var(--success),#3cbfa7); }
.card-swipe-bg .ko{ background:linear-gradient(120deg,#ff6a6a,#c13232); }

.swipe-row{ position:relative; z-index:1; will-change:transform; transition:transform .18s ease; }
.swipe-row.dragging{ transition:none; }
/* === Скрыть описание в карточках (модалка не трогаем) === */
.menu-card .card-description { display: none; }
/* 1) Скрываем описание в карточке */
.menu-card .card-description{ display:none; }

/* 2) Делаем заголовок одинаковой высоты (ровно 2 строки) —
      тогда футер у всех карточек окажется на одном уровне */
.menu-card h3{
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;          /* максимум 2 строки */
  -webkit-box-orient: vertical;
  overflow: hidden;
  min-height: calc(1.3em * 2);    /* резерв под 2 строки */
}

/* 3) На всякий случай фиксируем прижатие футера к низу карточки */
.menu-card{ display:flex; flex-direction:column; }
.menu-card .card-content{ display:flex; flex-direction:column; flex:1; }
.menu-card .card-footer{ margin-top:auto; }


  </style>
</head>

<body>
  <div class="page-wrapper">
    <header class="hero">
      <p class="eyebrow">restaurant noir</p>
      <h1>Элитное дегустационное меню</h1>
      <p class="subtitle">Роскошь в каждой детали: авторские блюда из редких ингредиентов, приготовленные шефами,
        прошедшими стажировки в лучших кухнях мира. Выберите своё сочетание вкусов, а мы оформим заказ мгновенно.</p>
      <div class="divider"></div>
    </header>

    <div class="layout">
      <main>
        <section class="menu-section" id="menu">
          <!-- Наши соцсети -->
          <div class="social-head">
            <span class="social-title">Наши соцсети</span>

            <a class="soc-btn soc-btn--wa" href="https://wa.me/77715120327" target="_blank" rel="noopener"
              aria-label="WhatsApp">
              <!-- WhatsApp -->
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12.04 2a9.9 9.9 0 0 0-8.45 14.94L2 22l5.2-1.52A9.95 9.95 0 1 0 12.04 2Zm0 1.8a8.15 8.15 0 0 1 0 16.3h-.02a8.1 8.1 0 0 1-4.14-1.15l-.3-.18-3.07.9.9-2.98-.2-.31A8.16 8.16 0 0 1 12.04 3.8Zm4.23 10.45c-.23-.12-1.35-.66-1.56-.73-.21-.08-.36-.12-.5.12-.15.23-.57.73-.7.88-.13.15-.26.17-.49.06-.23-.12-.99-.36-1.9-1.13-.7-.6-1.18-1.35-1.32-1.58-.14-.23-.02-.36.1-.48.1-.1.23-.26.34-.39.12-.13.15-.23.23-.4.07-.17.04-.31-.02-.43-.06-.12-.5-1.2-.68-1.64-.18-.44-.36-.37-.5-.37h-.43c-.14 0-.36.05-.55.26-.19.21-.72.7-.72 1.7 0 1 .74 1.96.85 2.1.12.15 1.45 2.2 3.5 3.08.49.21.86.34 1.16.44.49.16.94.14 1.29.08.39-.06 1.2-.49 1.37-.96.17-.48.17-.9.12-.98-.05-.08-.2-.12-.43-.24Z" />
              </svg>
            </a>

            <a class="soc-btn soc-btn--tg" href="https://t.me/yourname" target="_blank" rel="noopener"
              aria-label="Telegram">
              <!-- Telegram -->
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M21.94 3.2c-.34-.3-.84-.35-1.26-.22L2.7 9.1c-.53.18-.86.67-.86 1.14.01.48.36.93.9 1.08l4.64 1.3 1.78 5.73c.14.44.5.84 1.03.85.5.01.9-.33 1.2-.62l2.77-2.7 4.57 3.34c.24.17.53.26.81.26.18 0 .35-.03.51-.1.42-.18.72-.56.82-1l3.02-14.01c.13-.6-.02-1.08-.62-1.47ZM9.1 15.9l-.98-3.17 8.06-5.02-6.5 5.96 5.12 3.74-5.7-1.5Z" />
              </svg>
            </a>

            <a class="soc-btn soc-btn--ig" href="https://instagram.com/yourname" target="_blank" rel="noopener"
              aria-label="Instagram">
              <!-- Instagram -->
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12 7.3a4.7 4.7 0 1 0 0 9.4 4.7 4.7 0 0 0 0-9.4Zm0 7.7a3 3 0 1 1 0-6 3 3 0 0 1 0 6ZM17.6 6.2a1.1 1.1 0 1 0 0-2.2 1.1 1.1 0 0 0 0 2.2Z" />
                <path
                  d="M7.2 2h9.6A5.2 5.2 0 0 1 22 7.2v9.6A5.2 5.2 0 0 1 16.8 22H7.2A5.2 5.2 0 0 1 2 16.8V7.2A5.2 5.2 0 0 1 7.2 2Zm0 1.8A3.4 3.4 0 0 0 3.8 7.2v9.6a3.4 3.4 0 0 0 3.4 3.4h9.6a3.4 3.4 0 0 0 3.4-3.4V7.2a3.4 3.4 0 0 0-3.4-3.4H7.2Z" />
              </svg>
            </a>

            <a class="soc-btn soc-btn--tt" href="https://tiktok.com/@yourname" target="_blank" rel="noopener"
              aria-label="TikTok">
              <!-- TikTok -->
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M21.8 9.1a6.7 6.7 0 0 1-4.2-1.43V16a5.8 5.8 0 1 1-5.8-5.8c.2 0 .4 0 .6.03v2.06A3.8 3.8 0 1 0 13.6 18V2.5h2.7c.3 2.3 1.9 4 3.9 4.4v2.2Z" />
              </svg>
            </a>
          </div>

          <div class="section-header">
            <h2>Гастрономическая карта</h2>
            <p>Классические и экспериментальные блюда высокой кухни. Мы обновляем меню каждую неделю, сохраняя
              непревзойдённое качество и элегантную подачу.</p>
            <div id="categoryBar" class="category-bar"></div>
          </div>
          <div class="menu-grid" id="menuGrid"></div>
        </section>

        <section class="about" id="about">
          <h2>О нас</h2>
          <p>Noir Collection — закрытый клуб высокой кухни в центре Москвы. Кухня под руководством Ильи Воронова,
            выпускника Le Cordon Bleu, барная карта от лауреата международных конкурсов Арсения Мазаева и команда
            сомелье с уникальной винной библиотекой.</p>
          <div class="about-details">
            <div class="about-card">
              <strong>график</strong>
              <span>Ежедневно 12:00 — 02:00<br>Без выходных и праздничных перерывов</span>
            </div>
            <div class="about-card">
              <strong>контакты</strong>
              <span>+7 (771) 512-03-27<br>Менеджер Екатерина, WhatsApp / Telegram</span>
            </div>
            <div class="about-card">
              <strong>адрес</strong>
              <span>Москва, Гранатный переулок, 7с1<br>Закрытая парковка и услуга личного драйвера</span>
            </div>
            <div class="about-card">
              <strong>особенности</strong>
              <span>VIP-залы, дегустационные сеты, гастрономические спектакли и частные вечеринки под ключ</span>
            </div>
          </div>
        </section>
      </main>
      <aside class="cart-panel" aria-label="Корзина заказа">
        <div class="cart-header">
          <h2>Корзина</h2>
          <span class="cart-counter" id="cartCounter">0</span>
        </div>
        <div class="cart-list" id="cartItems"></div>
        <div class="cart-form">
          <label class="field">
            <span>Ваше имя</span>
            <input id="customerName" type="text" placeholder="" autocomplete="name">
          </label>
          <label class="field">
            <span>Адрес доставки</span>
            <textarea id="customerAddress" rows="2" placeholder="Улица, дом, кв."></textarea>
          </label>
          <label class="field">
            <span>Доп. номер телефона</span>
            <input id="customerPhone" type="tel" placeholder="" autocomplete="tel">
          </label>
        </div>
        <div class="cart-footer">
          <div class="total">
            <span>Итого</span>
            <span id="cartTotal">0 &#8376;</span>
          </div>
          <button class="checkout-button" id="checkoutButton" disabled>Оформить заказ</button>
          <p class="checkout-hint">После оформления заказа менеджер свяжется с вами в WhatsApp для подтверждения и
            уточнения деталей.</p>
        </div>
      </aside>
    </div> <!-- /layout -->
  </div> <!-- /page-wrapper -->
 <!-- МОДАЛКА ВНЕ СЕТКИ -->
<div class="modal hidden" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-dialog">
    <button class="close-button" id="modalClose" aria-label="Закрыть">&times;</button>
    <img src="" alt="" class="modal-image" id="modalImage">
    <div class="modal-body">
      <div class="badges badges--modal" id="modalBadges"></div>
      <h3 class="modal-title" id="modalTitle">Название блюда</h3>
      <p class="modal-description" id="modalDescription"></p>
      <p class="modal-details" id="modalDetails"></p>
      <div class="modal-footer">
        <span class="modal-price" id="modalPrice">0 &#8376;</span>
        <button class="modal-add" id="modalAddButton" type="button">Добавить в корзину</button>
      </div>
    </div>
  </div>
</div>

  <!-- Плавающая мини-корзина -->
  <button id="miniCartBtn" class="mini-cart" type="button">
    <span class="mini-cart__counter" id="miniCartCount">0</span>
    <span class="mini-cart__label">Сделать заказ</span>
  </button>

  <!-- Модалка корзины -->
  <div class="modal hidden" id="cartModal" aria-modal="true" role="dialog">
    <div class="modal-dialog cart-dialog">
      <button class="close-button" id="cartModalClose" aria-label="Закрыть">&times;</button>
      <img src="" alt="" style="display:none"> <!-- не трогай, для фокуса Safari -->

      <div class="modal-body">
        <h3 class="modal-title">Ваш заказ</h3>

        <!-- Список товаров -->
        <div id="cartModalList" class="cart-modal-list"></div>

        <!-- Поля клиента -->
        <div class="cart-form" style="margin-top:12px">
          <label class="field">
            <span>Ваше имя</span>
            <input id="customerNameModal" type="text" placeholder="Например, Екатерина" autocomplete="name">
          </label>
          <label class="field">
            <span>Адрес доставки</span>
            <textarea id="customerAddressModal" rows="2" placeholder="Улица, дом, кв., ориентир"></textarea>
          </label>
          <label class="field">
            <span>Доп. номер телефона</span>
            <input id="customerPhoneModal" type="tel" placeholder="+7 777 123-45-67" autocomplete="tel">
          </label>
        </div>

        <div class="cart-dialog__footer">
          <span class="modal-price" id="cartModalTotal">0 ₸</span>
          <div class="cart-footer-right">
            <button class="ghost-button" id="shareCartBtn" type="button">Поделиться</button>
            <button class="modal-add" id="cartModalCheckout" type="button">Оформить заказ</button>
            <span class="cart-error" id="cartEmptyMsg">Корзина пуста, выберите блюдо</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // Мини-корзина и модалка корзины

    const miniCartBtn = document.getElementById("miniCartBtn");
    const miniCartCount = document.getElementById("miniCartCount");
    const modalBadges = document.getElementById("modalBadges");

    const cartModal = document.getElementById("cartModal");
    const cartModalClose = document.getElementById("cartModalClose");
    const cartModalList = document.getElementById("cartModalList");
    const cartModalTotal = document.getElementById("cartModalTotal");
    const cartModalCheckout = document.getElementById("cartModalCheckout");

    // Поля формы в модалке (приоритетные)
    const nameModal = document.getElementById("customerNameModal");
    const addrModal = document.getElementById("customerAddressModal");
    const phoneModal = document.getElementById("customerPhoneModal");
    const cartEmptyMsg = document.getElementById("cartEmptyMsg");
    function showEmptyCartFeedback(trigger) {
      // Дрожание кнопки
      if (trigger) {
        trigger.classList.remove('is-shaking'); // сброс, чтобы анимация перезапускалась
        void trigger.offsetWidth;               // рефлоу
        trigger.classList.add('is-shaking');
        setTimeout(() => trigger.classList.remove('is-shaking'), 600);
      }
      // Показ текста "Корзина пуста..." в модалке
      const msg = document.getElementById('cartEmptyMsg');
      if (msg) {
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 3500);
      }
    }

    //// ===== МОДАЛКА КОРЗИНЫ =====
    function openCartModal() {
      if (!cartModal) return;
      // Если корзина пустая — пока тоже показываем, чтобы проверить открытие.
      // Когда всё заработает, вернёшь обратно "if (!cart.length) return;"
      // if (!cart.length) return;

      renderCart();                           // на всякий случай обновим содержимое
      cartModal.classList.remove("hidden");   // показать модалку
      document.body.classList.add("modal-open");
      if (nameModal) setTimeout(() => nameModal.focus(), 0);
    }

    function closeCartModal() {
      if (!cartModal) return;
      cartModal.classList.add("hidden");
      document.body.classList.remove("modal-open");
    }

    // Слушатели ошибка корзины
    if (miniCartBtn) miniCartBtn.addEventListener("click", () => {
      if (!cart.length) {
        openCartModal();                    // откроем модалку, чтобы было видно текст
        showEmptyCartFeedback(miniCartBtn); // дрожим кнопкой + покажем "корзина пуста"
        return;
      }
      openCartModal();
    });

    if (cartModalClose) cartModalClose.addEventListener("click", closeCartModal);
    if (cartModal) {
      cartModal.addEventListener("click", (e) => {
        if (e.target === cartModal) closeCartModal();
      });
    }
    if (cartModalList) cartModalList.addEventListener("click", handleCartClick); // +/- в модалке
    function onCartModalCheckoutClick() {
      if (!cart.length) {                   // пусто — не уходим в WhatsApp
        showEmptyCartFeedback(cartModalCheckout);
        return;
      }
      checkout();
    }
    if (cartModalCheckout) cartModalCheckout.addEventListener("click", onCartModalCheckoutClick);

    // отправка в WhatsApp

    // Закрытие по Esc: закрываем обе модалки
    document.addEventListener("keydown", (e) => {
      if (e.key !== "Escape") return;
      if (cartModal && !cartModal.classList.contains("hidden")) closeCartModal();
      if (typeof modalOverlay !== "undefined" &&
        modalOverlay && !modalOverlay.classList.contains("hidden")) {
        closeModal();
      }
    });



    const menuItems = [

      {
        id: "carpaccio-marble-beef",
        name: "Карпаччо из мраморной говядины",
        price: 18000,
        description: "Тонкие слайсы говядины с пармезаном и маслом белого трюфеля",
        details: "Мраморная говядина grain-fed выдержки 45 дней, руккола, пармезан, каперсы и масло First Harvest с бальзамиком.",
        image: ".vscode/images/Karpacho.jpg"
      },
      {
        id: "tartare-salmon",
        name: "Тартар из дикого лосося",
        price: 16000,
        description: "Дикий лосось, юдзу и крем из авокадо",
        details: "Северный лосось ручной разделки, крем из авокадо, юдзу, маринованный огурец и вафля из нори.",
        image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "foie-gras-fig",
        name: "Фуа-гра с инжиром",
        price: 21000,
        description: "Нежный террин из фуа-гра с карамелизированным инжиром",
        details: "Французская фуа-гра, инжировый чатни, миндальный бриошь, соус из мадеры и розовый перец.",
        image: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "caviar-imperial",
        name: "Осетровая икра «Императорская»",
        price: 55000,
        description: "30 грамм премиальной икры с тающим блинчиком",
        details: "Икра осетра сорта Imperial Gold, подаётся с топлёным маслом, мини-блинчиками и охлаждённой сметаной.",
        image: "https://images.unsplash.com/photo-1457460866886-40ef8f67fa56?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "ceviche-scallop",
        name: "Севиче из гребешка",
        price: 19000,
        description: "Северный гребешок, лайм и мусс из манго",
        details: "Хоккайдский гребешок, кокосовая вода, гранитэ из лайма, крем манго-чили и микрозелень кориандра.",
        image: "https://images.unsplash.com/photo-1481931715705-36cae98c0fe1?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "soup-porcini",
        name: "Суп-капучино из белых грибов",
        price: 13000,
        description: "Пенистый крем-суп с трюфельной пеной",
        details: "Бульон из белых грибов, сливки, пармезан, взбитая трюфельная пена и хрустящие крутоны.",
        image: "https://images.unsplash.com/photo-1525755667761-9811be0df9a4?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "duck-truffle",
        name: "Утиная грудка с трюфелем",
        price: 24000,
        description: "Розовая утка с соусом из чёрного трюфеля",
        details: "Утка Мулард, запечённая до medium, пюре из пастернака, чёрный трюфель и соус из порто.",
        image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "steak-black-angus",
        name: "Стейк из Black Angus",
        price: 37000,
        description: "Medium rare с копчёным картофелем",
        details: "Мраморный рибай Black Angus, пряное масло, копчёный картофель на гриле и соус демиглас.",
        image: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "lobster-thermidor",
        name: "Лобстер термидор",
        price: 42000,
        description: "Запечённый лобстер с шампанским и пармезаном",
        details: "Атлантический лобстер, крем из шампанского, пармезан, дижонская горчица и хрустящий пангратто.",
        image: "https://images.unsplash.com/photo-1482049016688-2d3e1b311543?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "ravioli-crab",
        name: "Равиоли с камчатским крабом",
        price: 26000,
        description: "Домашняя паста, крем из васаби и лайма",
        details: "Свежие равиоли с мясом камчатского краба, соус из сливок и васаби, лаймовое масло и икринки тобико.",
        image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=80&sat=-100"
      },
      {
        id: "halibut-saffron",
        name: "Палтус с шафрановым биском",
        price: 26000,
        description: "Деликатный палтус и шафрановый соус",
        details: "Филе палтуса sous-vide, шафрановый биск из раков, крем-пюре из цветной капусты и ферментированный лимон.",
        image: "https://images.unsplash.com/photo-1525755667761-9811be0df9a4?auto=format&fit=crop&w=1200&q=60&sat=-80"
      },
      {
        id: "crab-thai",
        name: "Краб в тайском стиле",
        price: 48000,
        description: "Синий краб, кокос и аромат лайма",
        details: "Синий краб, кокосовое молоко, паста том-ям, лимонграсс, кинза и жареный рисовый чипс.",
        image: "https://images.unsplash.com/photo-1466978913421-dad2ebd01d17?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "takoyaki-roe",
        name: "Такояки с лососевой икрой",
        price: 15000,
        description: "Пончики с осьминогом, тобико и соус тонкацу",
        details: "Традиционные такояки с осьминогом, сливочный соус, икра тобико, хлопья бонито и соус тонкацу.",
        image: "https://images.unsplash.com/photo-1514516430032-7d5fcd82d77c?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "octopus-charcoal",
        name: "Осьминог на углях",
        price: 32000,
        description: "Карамелизированное щупальце и копчёный картофель",
        details: "Щупальца средиземноморского осьминога, копчёный картофель, чёрный айоли и соус из копчёного перца.",
        image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=80&sat=-30"
      },
      {
        id: "pate-quail",
        name: "Паштет из перепёлки",
        price: 14000,
        description: "Сливочный паштет с вишнёвым чатни",
        details: "Перепелиная печень, коньяк, сливочное масло, чатни из вишни и хрустящий бриошь.",
        image: "https://images.unsplash.com/photo-1504753793650-d4a2b783c15e?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "risotto-truffle",
        name: "Ризотто с белым трюфелем",
        price: 36000,
        description: "Арборио, белый трюфель и пармезан",
        details: "Рис арборио, домашний бульон, белый трюфель, пармезан Reggiano и масло из шалфея.",
        image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=60"
      },
      {
        id: "lamb-rosemary",
        name: "Ягнёнок с розмарином",
        price: 28000,
        description: "Седло ягнёнка и соус из красного вина",
        details: "Седло ягнёнка sous-vide, розмарин, крем из батата, печёные овощи и соус бордо.",
        image: "https://images.unsplash.com/photo-1525755667761-9811be0df9a4?auto=format&fit=crop&w=1200&q=70"
      },
      {
        id: "carbonara-guanciale",
        name: "Карбонара с гуанчале",
        price: 17000,
        description: "Римская паста на желтках и гуанчале",
        details: "Спагетти, гуанчале, яичные желтки, пекорино романо и свежемолотый перец.",
        image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "scallop-lime-mousse",
        name: "Гребешок с лаймовым муссом",
        price: 23000,
        description: "Лёгкий мусс, лайм и морская соль",
        details: "Обжаренный морской гребешок, воздушный лаймовый мусс, хрустящий киноа и соль Мальдон.",
        image: "https://images.unsplash.com/photo-1525755667761-9811be0df9a4?auto=format&fit=crop&w=1200&q=50"
      },
      {
        id: "tarte-tatin",
        name: "Тарт Татен с карамельными яблоками",
        price: 11000,
        description: "Карамелизированные яблоки и ванильный пломбир",
        details: "Яблоки сорта Pink Lady, карамель, слоёное тесто, ванильное мороженое и соус из сидра.",
        image: "https://images.unsplash.com/photo-1504753793650-d4a2b783c15e?auto=format&fit=crop&w=1200&q=70"
      },
      {
        id: "chocolate-fondant",
        name: "Шоколадный фондан",
        price: 12000,
        description: "Тёплый шоколад с жидкой сердцевиной",
        details: "70% тёмный шоколад, фисташковый пралине, мороженое из бобов тонка и какао-круст.",
        image: "https://images.unsplash.com/photo-1499636136210-6f4ee915583e?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "icecream-champagne",
        name: "Сорбет из шампанского",
        price: 9000,
        description: "Освежающий сорбет и ягоды шардоне",
        details: "Домашний сорбет из шампанского brut, маракуйя, клубничный конфи и съедобные цветы.",
        image: "https://images.unsplash.com/photo-1455619452474-d2be8b1e70cd?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "cheese-platter",
        name: "Сырная коллекция Noir",
        price: 20000,
        description: "Пять выдержанных сыров и дополнения",
        details: "Комте, Горгонзола, Том де Савой, козий Том и фермерский Камамбер, подаются с гриссини и мёдом.",
        image: "https://images.unsplash.com/photo-1543353071-873f17a7a088?auto=format&fit=crop&w=1200&q=40"
      },
      {
        id: "mini-burger",
        name: "Мини-бургер с мраморной говядиной",
        price: 15000,
        description: "Авторский мини-бургер с трюфельным айоли",
        details: "Булочка бриошь, котлета из мраморной говядины, трюфельный айоли, салат романо и вяленый томат.",
        image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?auto=format&fit=crop&w=1200&q=40"
      },
      {
        id: "gazpacho-yellow",
        name: "Жёлтый гаспачо",
        price: 12000,
        description: "Томатный холодный суп с манго",
        details: "Жёлтые томаты, манго, огурец, сладкий перец, оливковое масло и масло базилика.",
        image: "https://images.unsplash.com/photo-1553532434-5ab5b6b84993?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "salad-burrata",
        name: "Салат с бурратой",
        price: 21000,
        description: "Кремовая буррата и томаты heirloom",
        details: "Буррата из Апулии, томаты heirloom, базилик, песто из кедровых орешков и бальзамическая карамель.",
        image: "https://images.unsplash.com/photo-1470337458703-46ad1756a187?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "scallop-curry",
        name: "Гребешок в пряном карри",
        price: 25000,
        description: "Морской гребешок и соус карри",
        details: "Обжаренный гребешок, кокосовый соус карри, маринованный дайкон и масло чили.",
        image: "https://picsum.photos/seed/scallop/800/600"
      },
      {
        id: "sashimi-ultra",
        name: "Сашими «Ультра»",
        price: 39000,
        description: "Тунец, лосось, желтохвост и гребешок",
        details: "Ассорти из сашими премиум-класса, васаби, понзу и огуречный хруст.",
        image: "https://picsum.photos/seed/sashimi/800/600"
      },
      {
        id: "yuzu-lemonade",
        name: "Лимонад юдзу",
        price: 8000,
        description: "Цитрусовый лимонад с жасмином",
        details: "Юдзу, жасминовый сироп, газированная вода, мята и лимонная цедра.",
        image: "https://picsum.photos/seed/yuzu/800/600"
      },
      {
        id: "cocktail-night-orchid",
        name: "Коктейль «Ночная орхидея»",
        price: 9500,
        description: "Джин, фиалковый ликёр и личи",
        details: "Джин, ликёр Parfait Amour, пюре личи, лайм и лавандовый спрей.",
        image: "https://images.unsplash.com/photo-1516685018646-549198525c1b?auto=format&fit=crop&w=1200&q=80"
      },
      {
        id: "oysters-gillardeau",
        name: "Устрицы Gillardeau №2",
        price: 27000,
        description: "Подаются со льдом и цитрусовым соусом",
        details: "Устрицы Gillardeau №2, гранитэ из шампанского, соус мигнонетт и лаймовый крем.",
        image: "https://picsum.photos/seed/oysters/800/600"
      },
      {
        id: "wagyu-gunkan",
        name: "Гунканы с вагю и трюфелем",
        price: 31000,
        description: "Мраморная говядина вагю и чёрный трюфель",
        details: "Вагю А5, рис для суши, чёрный трюфель, соус унаги и микроруккола.",
        image: "https://picsum.photos/seed/wagyu/800/600"
      },
      {
        id: "foamy-espresso",
        name: "Кремовый эспрессо-тоник",
        price: 7000,
        description: "Эспрессо, тоник и цитрусовая пенка",
        details: "Двойной эспрессо, тоник, пенка из бергамота и карамелизированный лимон.",
        image: "https://picsum.photos/seed/espresso/800/600"
      },
      {
        id: "matcha-tiramisu",
        name: "Тирамису с матча",
        price: 12500,
        description: "Матча, нежный маскарпоне и савоярди",
        details: "Матча, маскарпоне, савоярди, японский ром и шоколадный мусс.",
        image: "https://picsum.photos/seed/matcha/800/600"
      },
      {
        id: "black-cod-miso",
        name: "Чёрная треска в мисо",
        price: 33000,
        description: "Мисо-глазурь и маринованный дайкон",
        details: "Чёрная треска, маринад мисо, дайкон, кунжут и соус понзу.",
        image: "https://picsum.photos/seed/blackcod/800/600"
      },
      {
        id: "beef-tataki",
        name: "Биф татакі",
        price: 21000,
        description: "Лёгко обожжённая говядина и соус понзу",
        details: "Мраморная говядина, соус понзу, редис дайкон, зелёный лук и масло чили.",
        image: "https://picsum.photos/seed/tataki/800/600"

      }
    ];
    // Гарантируем, что у каждого блюда есть массив badges
    menuItems.forEach(it => { if (!Array.isArray(it.badges)) it.badges = []; });



    // Подписи для бейджей
    const BADGE_LABELS = {
      hit: "Хит",
      new: "Новинка",
      spicy: "Остро",
      vegan: "Веган",
      premium: "Премиум",
      seasonal: "Сезон"
    };

    // Рендер списка бейджей в HTML
    function renderBadges(list) {
      if (!Array.isArray(list) || !list.length) return "";
      return list
        .map(k => `<span class="badge badge--${k}">${BADGE_LABELS[k] ?? k}</span>`)
        .join("");
    }

    // === 3.1 Автоматически проставим категорию (если её нет) ===
    function autoCategory(item) {
      const n = item.name.toLowerCase();
      if (/суп|капучино/.test(n)) return 'Супы';
      if (/салат|буррата/.test(n)) return 'Салаты';
      if (/фондан|сорбет|тарт|тирамису|десерт/.test(n)) return 'Десерты';
      if (/лимонад|коктейль|эспрессо|тоник/.test(n)) return 'Напитки';
      if (/сашими|гункан|татак/.test(n)) return 'Суши & Сашими';
      if (/икра|устриц|лосос|краб|гребеш|осьминог|палтус|треск/.test(n)) return 'Морепродукты';
      if (/карпаччо|тартар|фуа|паштет|такояки|сырная/.test(n)) return 'Закуски';
      return 'Горячие блюда';
    }
    // Проставим category там, где его ещё нет в объектах блюд
    menuItems.forEach(i => { if (!i.category) i.category = autoCategory(i); });

    // Текущая выбранная категория (по умолчанию показываем всё)
    let currentCategory = 'Все';
    function getCategoryCounts() {
      const m = new Map();
      menuItems.forEach(i => m.set(i.category, (m.get(i.category) || 0) + 1));
      return m;
    }

   function renderCategoryBar() {
  const wrap = document.getElementById('categoryBar');
  if (!wrap) return;
  const counts = getCategoryCounts();
  const cats = ['Все', ...Array.from(counts.keys()).sort()];
  wrap.innerHTML = cats.map(c => `
    <button class="cat-chip ${c === currentCategory ? 'is-active' : ''}" data-cat="${c}">
      ${c}${c !== 'Все' ? ` <span class="count">${counts.get(c) || 0}</span>` : ''}
    </button>
  `).join('');
  wrap.onclick = (e) => {
    const btn = e.target.closest('.cat-chip');
    if (!btn) return;
    currentCategory = btn.dataset.cat;
    renderCategoryBar();
    renderMenu(currentCategory);
  };
}



    const menuGrid = document.getElementById("menuGrid");
    const modalOverlay = document.getElementById("modalOverlay");
    const modalImage = document.getElementById("modalImage");
    const modalTitle = document.getElementById("modalTitle");
    const modalDescription = document.getElementById("modalDescription");
    const modalDetails = document.getElementById("modalDetails");
    const modalPrice = document.getElementById("modalPrice");
    const modalAddButton = document.getElementById("modalAddButton");
    const modalClose = document.getElementById("modalClose");
    const cartItemsContainer = document.getElementById("cartItems");
    const cartCounter = document.getElementById("cartCounter");
    const cartTotal = document.getElementById("cartTotal");
    const checkoutButton = document.getElementById("checkoutButton");
    const menuMap = new Map(menuItems.map(item => [item.id, item]));
    const formatPrice = v => `${v.toLocaleString('ru-RU')} \u20B8`;
// Единственная корректная функция рендера карточек
function renderMenu(filterCat = 'Все') {
  const list = (filterCat === 'Все') ? menuItems : menuItems.filter(i => i.category === filterCat);
  const fragment = document.createDocumentFragment();

  list.forEach(item => {
    const card = document.createElement("article");
    card.className = "menu-card";
    card.dataset.id = item.id;
  card.innerHTML = `
  <div class="card-swipe-bg" aria-hidden="true">
    <div class="ok" title="Добавить">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9.2 16.6 4.9 12.3l1.4-1.4 2.9 2.9 8.5-8.5 1.4 1.4z"/></svg>
    </div>
    <div class="ko" title="Убрать">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M18.3 5.7 12 12l6.3 6.3-1.4 1.4L10.6 13.4 4.3 19.7 2.9 18.3 9.2 12 2.9 5.7 4.3 4.3l6.3 6.3 6.3-6.3z"/></svg>
    </div>
  </div>

  <div class="swipe-row">
    <div class="card-image">
      <img src="${item.image}" alt="${item.name}">
      <div class="card-gradient"></div>
    </div>

    <div class="card-content">
      <div>
        <h3>${item.name}</h3>
        <p class="card-description">${item.description}</p>
      </div>

      <div class="card-footer">
        <span class="card-price">${formatPrice(item.price)}</span>

        <!-- ДЕСКТОП: +/- -->
        <div class="card-qty-controls desktop-only" data-id="${item.id}">
          <button type="button" class="card-qty-btn" data-action="decrease" data-id="${item.id}" aria-label="Уменьшить количество">-</button>
          <span class="card-qty-count" data-id="${item.id}">0</span>
          <button type="button" class="card-qty-btn" data-action="increase" data-id="${item.id}" aria-label="Увеличить количество">+</button>
        </div>

        <!-- МОБИЛА: старый ползунок можно скрыть правилами body.card-swipe -->
        <div class="swipe-to-cart mobile-only" data-id="${item.id}">
          <div class="swipe-track">
            <div class="swipe-label">Свайпните, чтобы добавить</div>
            <div class="swipe-handle" aria-label="Добавить"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
`;

    fragment.appendChild(card);
  });
  // ↓ ЭТО ДОЛЖНО БЫТЬ ВНУТРИ ФУНКЦИИ ( это меню )
  menuGrid.innerHTML = '';
  menuGrid.appendChild(fragment);
  initSwipeToCart();
if (window.matchMedia('(pointer: coarse)').matches) initCardSwipe();

}
// Добавить из модалки в корзину
if (modalAddButton) {
  modalAddButton.addEventListener("click", () => {
    if (currentModalItemId) {
      addToCart(currentModalItemId); // кладём выбранное блюдо
          closeModal();                  // закрываем карточку блюда
        }
      });
    }
    // Закрыть модалку
   // === Состояние корзины и модалки ===
const cart = [];
let currentModalItemId = null;
let swipeInProgress = false; // ← нужен глобально

function initCardSwipe(){
  document.querySelectorAll('.menu-card .swipe-row').forEach(row=>{
    if (row._bound) return; row._bound = true;

    const card = row.closest('.menu-card');
    const id   = card.dataset.id;
    const bg   = card.querySelector('.card-swipe-bg');

    let startX=0, dx=0, active=false, moved=false;

    const MAX   = 120;
    const THRESH= () => Math.min(96, card.clientWidth*0.28);
    const setX  = x => { dx=x; row.style.transform=`translateX(${dx}px)`; };

    row.addEventListener('pointerdown', e=>{
      if (e.pointerType==='mouse') return;
      active=true; moved=false; swipeInProgress=true;
      startX=e.clientX; row.classList.add('dragging'); bg.classList.add('show');
      row.setPointerCapture?.(e.pointerId);
    }, {passive:true});

    row.addEventListener('pointermove', e=>{
      if (!active) return;
      const delta=e.clientX-startX;
      if (Math.abs(delta)>3) moved=true;
      const limited=Math.max(-MAX, Math.min(delta, MAX));
      setX(limited);
      if (e.cancelable) e.preventDefault();
    }, {passive:false});

    const end = ()=>{
      if (!active) return;
      row.classList.remove('dragging'); bg.classList.remove('show');

      const ok   = Math.abs(dx) >= THRESH();
      const sign = Math.sign(dx);

      setX(0);
      active=false; swipeInProgress=false;

      if (!ok) return;

      if (sign>0){
        addToCart(id); haptic(); flash(card,'ok');
      } else {
        const exists = cart.find(x=>x.id===id);
        if (exists) adjustCart(id, -1);
        haptic(); flash(card,'ko');
      }
    };

    row.addEventListener('pointerup', end, {passive:true});
    row.addEventListener('pointercancel', end, {passive:true});
    row.addEventListener('click', e=>{ if (moved) e.stopPropagation(); }, true);
  });
}

function haptic(){ try{ navigator.vibrate?.(10); }catch{} }

function flash(card,type){
  const color = type==='ok' ? 'rgba(78,209,185,.35)' : 'rgba(243,86,86,.35)';
  card.animate(
    [{ boxShadow:'0 0 0 0 rgba(0,0,0,0)' }, { boxShadow:`0 0 0 14px ${color}` }],
    { duration:220, easing:'ease-out' }
  );
}


function syncCardQuantities() {
  document.querySelectorAll(".card-qty-count").forEach(span => {
    const id = span.dataset.id;
    const entry = cart.find(x => x.id === id);
    span.textContent = entry ? entry.quantity : 0;
  });
}

function openModal(itemId){
  const item = menuMap.get(itemId);
  if (!item) return;

  currentModalItemId = itemId;

  if (modalBadges) modalBadges.innerHTML = renderBadges(item.badges || []);

  modalImage.src = item.image;
  modalImage.alt = item.name;
  modalTitle.textContent = item.name;
  modalDescription.textContent = item.description;
  modalDetails.textContent = item.details;
  modalPrice.textContent = formatPrice(item.price);

  modalOverlay.classList.remove("hidden");
  document.body.classList.add("modal-open");
  modalAddButton?.focus();
}

function closeModal() {
  modalOverlay.classList.add("hidden");
  document.body.classList.remove("modal-open");
}

function addToCart(itemId) {
  const item = menuMap.get(itemId);
  if (!item) return;

  const existing = cart.find(e => e.id === itemId);
  if (existing) existing.quantity += 1;
  else cart.push({ id: itemId, name: item.name, price: item.price, image: item.image, quantity: 1 });

  renderCart();
}

function renderCart() {
  // Боковая корзина
  if (cartItemsContainer) {
    cartItemsContainer.innerHTML = cart.length
      ? cart.map(entry => `
        <div class="cart-item">
          <div class="cart-item-info">
            <img src="${entry.image}" alt="${entry.name}">
            <div>
              <p class="cart-item-name">${entry.name}</p>
              <span class="cart-item-price">${formatPrice(entry.price)}</span>
            </div>
          </div>
          <div class="cart-controls">
            <button type="button" data-action="decrease" data-id="${entry.id}">-</button>
            <span class="cart-quantity">${entry.quantity}</span>
            <button type="button" data-action="increase" data-id="${entry.id}">+</button>
          </div>
        </div>
      `).join("")
      : '<p class="cart-empty">Добавьте блюда, чтобы сформировать персональный заказ.</p>';
  }
  function initCardSwipe(){
  document.querySelectorAll('.menu-card .swipe-row').forEach(row=>{
    if (row._bound) return; row._bound = true;

    const card = row.closest('.menu-card');
    const id   = card.dataset.id;
    const bg   = card.querySelector('.card-swipe-bg');

    let startX=0, dx=0, active=false, moved=false;

    const MAX=120;
    const THRESH = ()=> Math.min(96, card.clientWidth*0.28);
    const setX = x => { dx=x; row.style.transform=`translateX(${dx}px)`; };

    row.addEventListener('pointerdown', e=>{
      if (e.pointerType==='mouse') return;
      active=true; moved=false; swipeInProgress=true;
      startX=e.clientX; row.classList.add('dragging'); bg.classList.add('show');
      row.setPointerCapture?.(e.pointerId);
    }, {passive:true});

    row.addEventListener('pointermove', e=>{
      if (!active) return;
      const delta=e.clientX-startX;
      if (Math.abs(delta)>3) moved=true;
      const limited = Math.max(-MAX, Math.min(delta, MAX));
      setX(limited);
      if (e.cancelable) e.preventDefault();
    }, {passive:false});

    const end = ()=>{
      if (!active) return;
      row.classList.remove('dragging'); bg.classList.remove('show');

      const ok = Math.abs(dx) >= THRESH();
      const sign = Math.sign(dx);

      setX(0);
      active=false; swipeInProgress=false;

      if (!ok) return;

      if (sign>0){
        addToCart(id); haptic(); flash(card,'ok');         // вправо — плюс
      } else {
        const exists = cart.find(x=>x.id===id);
        if (exists) adjustCart(id, -1);                    // влево — минус
        haptic(); flash(card,'ko');
      }
    };

    row.addEventListener('pointerup', end, {passive:true});
    row.addEventListener('pointercancel', end, {passive:true});

    // если был явный свайп — не открываем модалку кликом
    row.addEventListener('click', e=>{ if (moved) e.stopPropagation(); }, true);
  });
}

function haptic(){ try{ navigator.vibrate?.(10); }catch{} }

function flash(card,type){
  const color = type==='ok' ? 'rgba(78,209,185,.35)' : 'rgba(243,86,86,.35)';
  card.animate(
    [{ boxShadow:'0 0 0 0 rgba(0,0,0,0)' }, { boxShadow:`0 0 0 14px ${color}` }],
    { duration:220, easing:'ease-out' }
  );
}


  // Суммы/счётчики
  const totalCount = cart.reduce((s, e) => s + e.quantity, 0);
  const totalPrice = cart.reduce((s, e) => s + e.price * e.quantity, 0);

  cartCounter && (cartCounter.textContent = totalCount);
  cartTotal   && (cartTotal.textContent   = formatPrice(totalPrice));

  const cartModalListEl  = document.getElementById("cartModalList");
  const cartModalTotalEl = document.getElementById("cartModalTotal");
  const miniCartCountEl  = document.getElementById("miniCartCount");

  if (cartModalListEl) {
    cartModalListEl.innerHTML = cart.length ? cart.map(entry => `
      <div class="cart-item">
        <div class="cart-item-info">
          <img src="${entry.image}" alt="${entry.name}"
               style="width:48px;height:48px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.08)">
          <div>
            <p class="cart-item-name" style="margin:0;font-size:14px;font-weight:500">${entry.name}</p>
            <span class="cart-item-price" style="display:block;margin-top:6px;color:var(--text-muted);font-size:12px">
              ${formatPrice(entry.price)}
            </span>
          </div>
        </div>
        <div class="cart-controls">
          <button type="button" data-action="decrease" data-id="${entry.id}">-</button>
          <span class="cart-quantity">${entry.quantity}</span>
          <button type="button" data-action="increase" data-id="${entry.id}">+</button>
        </div>
      </div>
    `).join("") : '<p class="cart-empty">Корзина пуста.</p>';
  }

  cartModalTotalEl && (cartModalTotalEl.textContent = formatPrice(totalPrice));
  miniCartCountEl  && (miniCartCountEl.textContent  = totalCount);

  // Кнопка «Оформить»
  checkoutButton && (checkoutButton.disabled = cart.length === 0);

  // Синхронизация количества на карточках
  syncCardQuantities();
}

function adjustCart(itemId, delta) {
  const entry = cart.find(e => e.id === itemId);
  if (!entry) return;

  entry.quantity += delta;
  if (entry.quantity <= 0) {
    const idx = cart.findIndex(e => e.id === itemId);
    cart.splice(idx, 1);
  }
  renderCart();
}

function handleCartClick(event) {
  const action = event.target.dataset.action;
  const id = event.target.dataset.id;
  if (!action || !id) return;
  if (action === "increase") adjustCart(id, 1);
  if (action === "decrease") adjustCart(id, -1);
}

function checkout() {
  if (!cart.length) return;

  // читаем из модалки (приоритет) или из боковой панели
  const get = (modalId, sideId) => {
    const m = document.getElementById(modalId);
    const s = document.getElementById(sideId);
    return (m && m.value.trim()) || (s && s.value.trim()) || "";
  };

  const name  = get("customerNameModal",   "customerName");
  const addr  = get("customerAddressModal","customerAddress");
  const phone = get("customerPhoneModal",  "customerPhone");

  const markError = (modalId, sideId) => {
    const el = document.getElementById(modalId) || document.getElementById(sideId);
    if (el) {
      el.classList.add("input-error");
      el.focus();
      el.scrollIntoView({ block: "center", behavior: "smooth" });
      setTimeout(() => el.classList.remove("input-error"), 1500);
    }
  };
  if (!name) { markError("customerNameModal","customerName"); return; }
  if (!addr) { markError("customerAddressModal","customerAddress"); return; }

  const managerPhone = "77715120327";
  const lines = cart.map(e => `${e.name} x${e.quantity} — ${formatPrice(e.price * e.quantity)}`);
  const total = cart.reduce((s, e) => s + e.price * e.quantity, 0);

  const text = [
    "Здравствуйте! Хочу оформить заказ из Noir Collection:",
    "",
    `Имя: ${name}`,
    `Адрес: ${addr}`,
    phone ? `Доп. телефон: ${phone}` : null,
    "",
    ...lines,
    "",
    `Итого: ${formatPrice(total)}`
  ].filter(Boolean).join("\n");

  const url = `https://wa.me/${managerPhone}?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
}

if (modalClose) modalClose.addEventListener("click", closeModal);
if (modalOverlay) {
  modalOverlay.addEventListener("click", (e) => {
    if (e.target === modalOverlay) closeModal();
  });
}
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && !modalOverlay.classList.contains("hidden")) {
    closeModal();
  }
});

// --- Клики по спискам: +/- и открытие карточки ---
if (cartItemsContainer) cartItemsContainer.addEventListener("click", handleCartClick);

if (menuGrid) {
  menuGrid.addEventListener("click", (e) => {
     // если только что был свайп — не открываем модалку
    if (swipeInProgress) { e.stopPropagation(); return; }
    const btn = e.target.closest(".card-qty-btn");
    if (btn) {
      e.stopPropagation();
      const { action, id } = btn.dataset;
      if (action === "increase") addToCart(id);
      if (action === "decrease") adjustCart(id, -1);
      return;
    }
    if (e.target.closest(".swipe-to-cart")) { e.stopPropagation(); return; }

    const card = e.target.closest(".menu-card");
    if (card) openModal(card.dataset.id);
  });
}


// --- Кнопка «Оформить заказ» в боковой панели ---
if (checkoutButton) {
  checkoutButton.addEventListener("click", () => {
    openCartModal();
    if (!cart.length) showEmptyCartFeedback(checkoutButton);
  });
}
function initSwipeToCart(){
  const THRESHOLD = 0.60; // как у Wolt: ~60% до «успеха»
  const supportsPE = 'PointerEvent' in window;

  document.querySelectorAll('.swipe-to-cart').forEach(wrap => {
    const track  = wrap.querySelector('.swipe-track');
    const handle = wrap.querySelector('.swipe-handle');
    if (!track || !handle || track._bound) return;
    track._bound = true;

    // клики по контролу не должны открывать модалку карточки
    const stop = e => { e.preventDefault(); e.stopPropagation(); };
    track.addEventListener('click', stop);
    handle.addEventListener('click', stop);

    handle.style.touchAction = 'pan-y';

    let startX = 0, dx = 0, active = false, pid = null;

    const max   = () => Math.max(0, track.clientWidth - handle.clientWidth);
    const setX  = x => { dx = Math.max(0, Math.min(x, max())); handle.style.transform = `translateX(${dx}px)`; };
    const setP  = () => { const m = max(); track.style.setProperty('--p', m ? (dx / m) : 0); };

    const onDown = (clientX, e) => {
      if (e && e.pointerType === 'mouse' && e.button !== 0) return;
      active = true;
      startX = clientX;
      pid = e?.pointerId ?? null;
      handle.style.transition = 'none';
      track.classList.remove('added');
      track.style.setProperty('--p', 0);
      document.body.style.userSelect = 'none';
      e?.target?.setPointerCapture?.(pid);
    };

    const onMove = (clientX, e) => {
      if (!active) return;
      // «мягкая резина» после края — ощущается приятнее
      const m = max();
      const raw = clientX - startX;
      const eased = raw < 0 ? 0 : raw > m ? m + Math.tanh((raw - m) / 20) * 12 : raw;
      setX(eased);
      setP();
      if (e?.cancelable) e.preventDefault();
    };

    const onUp = () => {
      if (!active) return;
      active = false;
      document.body.style.userSelect = '';
      handle.style.transition = '.25s transform';

      const m = max();
      const progress = m ? dx / m : 0;

      if (progress >= THRESHOLD) {
        setX(m); setP();
        const id = wrap.dataset.id;
        if (id) addToCart(id);
        if (navigator.vibrate) navigator.vibrate(10);

        track.classList.add('added');
        const lbl = track.querySelector('.swipe-label');
        const prev = lbl?.textContent || '';
        if (lbl) lbl.textContent = 'Добавлено';

        // короткая пауза — и плавный откат
        setTimeout(() => {
          if (lbl) lbl.textContent = prev;
          track.classList.remove('added');
          setX(0); setP();
        }, 650);
      } else {
        setX(0); setP();
      }
    };
let swipeInProgress = false; // чтобы клик не открывал модалку после свайпа

function initCardSwipe(){
  document.querySelectorAll('.menu-card .swipe-row').forEach(row=>{
    if (row._bound) return; row._bound = true;

    const card = row.closest('.menu-card');
    const id   = card.dataset.id;
    const bg   = card.querySelector('.card-swipe-bg');

    let startX = 0, dx = 0, active = false, moved = false;

    const MAX = 120; // максимум пикселей, чтобы «резина» не уезжала далеко
    const THRESH = () => Math.min(96, card.clientWidth * 0.28); // порог действия (~28% ширины)

    const setX = x => { dx = x; row.style.transform = `translateX(${dx}px)`; };

    row.addEventListener('pointerdown', e=>{
      if (e.pointerType === 'mouse' && e.button !== 0) return;
      active = true; moved = false; swipeInProgress = true;
      startX = e.clientX;
      row.classList.add('dragging');
      bg.classList.add('show');
      row.setPointerCapture?.(e.pointerId);
    }, { passive:true });

    row.addEventListener('pointermove', e=>{
      if (!active) return;
      const delta = e.clientX - startX;
      if (Math.abs(delta) > 3) moved = true;
      const limited = Math.max(-MAX, Math.min(delta, MAX));
      setX(limited);
      if (e.cancelable) e.preventDefault();
    }, { passive:false });

    const end = ()=>{
      if (!active) return;
      row.classList.remove('dragging'); bg.classList.remove('show');

      const ok = Math.abs(dx) >= THRESH();
      const sign = Math.sign(dx);

      setX(0);
      active = false; swipeInProgress = false;

      if (!ok) return;

      if (sign > 0){
        addToCart(id); haptic(); flash(card,'ok');         // вправо — добавить 1
      } else {
        const exists = cart.find(x=>x.id===id);
        if (exists) adjustCart(id, -1);                    // влево — минус 1 (до 0)
        haptic(); flash(card,'ko');
      }
    };

    row.addEventListener('pointerup', end, { passive:true });
    row.addEventListener('pointercancel', end, { passive:true });

    // если был явный свайп — блокируем «открыть модалку» кликом
    row.addEventListener('click', e => { if (moved) e.stopPropagation(); }, true);
  });
}

function haptic(){ try{ navigator.vibrate?.(10); }catch{} }
function flash(card, type){
  const color = type === 'ok' ? 'rgba(78,209,185,.35)' : 'rgba(243,86,86,.35)';
  card.animate(
    [{ boxShadow:'0 0 0 0 rgba(0,0,0,0)' }, { boxShadow:`0 0 0 14px ${color}` }],
    { duration:220, easing:'ease-out' }
  );
}

    // Pointer Events (современные браузеры/iOS 13+)
    if (supportsPE) {
      track.addEventListener('pointerdown', e => onDown(e.clientX, e), { passive:true });
      track.addEventListener('pointermove', e => onMove(e.clientX, e), { passive:false });
      track.addEventListener('pointerup',   onUp, { passive:true });
      track.addEventListener('pointercancel', onUp, { passive:true });
    } else {
      // Фоллбэк для старых WebKit
      track.addEventListener('touchstart', e => onDown(e.touches[0].clientX, e), { passive:true });
      track.addEventListener('touchmove',  e => onMove(e.touches[0].clientX, e), { passive:false });
      track.addEventListener('touchend',   onUp, { passive:true });
      track.addEventListener('mousedown',  e => onDown(e.clientX, e));
      window.addEventListener('mousemove', e => onMove(e.clientX, e));
      window.addEventListener('mouseup',   onUp);
    }
  });
}
// --- ИНИЦИАЛИЗАЦИЯ (п.3) ---
renderCategoryBar();
renderMenu(currentCategory);
renderCart();
// свайп и оформление только на тач-экранах
if (window.matchMedia('(pointer: coarse)').matches){
  document.body.classList.add('card-swipe');
}


// ====== SHARE CART ======
// ====== SHARE CART (fixed) ======
function buildCartShareURL() {
  // кодируем id и количество
  const data = { items: cart.map(e => ({ id: e.id, q: e.quantity })) };
  const base = (location.origin && location.origin !== 'null')
    ? `${location.origin}${location.pathname}`
    : location.href.split('?')[0];
  const payload = btoa(JSON.stringify(data));
  return `${base}?cart=${encodeURIComponent(payload)}`;
}

function isMobileUA() {
  return /Android|iPhone|iPad|iPod|Windows Phone|Mobi/i.test(navigator.userAgent);
}

async function fallbackCopy(text, btn) {
  let ok = false;
  try { await navigator.clipboard.writeText(text); ok = true; } catch {}
  if (!ok) {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.setAttribute('readonly','');
    ta.style.position='fixed';
    ta.style.opacity='0';
    document.body.appendChild(ta);
    ta.select();
    try { ok = document.execCommand('copy'); } catch {}
    document.body.removeChild(ta);
  }
  if (btn) {
    const prev = btn.textContent;
    btn.textContent = ok ? 'Ссылка скопирована' : 'Скопируйте ссылку';
    btn.disabled = true;
    setTimeout(()=>{ btn.textContent = prev; btn.disabled = false; }, 1800);
  } else {
    alert(ok ? 'Ссылка на корзину скопирована' : ('Скопируйте ссылку: ' + text));
  }
}

async function shareCart(e) {
  e?.preventDefault?.();
  if (!cart.length) { showEmptyCartFeedback(document.getElementById('shareCartBtn')); return; }

  const url = buildCartShareURL(); // ← правильное имя!
  const btn = document.getElementById('shareCartBtn');

  if (isMobileUA() && navigator.share) {
    try {
      await navigator.share({ title: 'Noir — мой заказ', text: 'Собрал корзину, посмотри:', url });
      return;
    } catch { /* отмена пользователем — пойдём в копирование */ }
  }
  await fallbackCopy(url, btn);
}

document.getElementById('shareCartBtn')?.addEventListener('click', shareCart);

// ====== RESTORE CART FROM URL (единая версия) ======
(function applySharedCartFromURL(){
  const p = new URLSearchParams(location.search).get('cart');
  if (!p) return;
  try {
    const data = JSON.parse(atob(decodeURIComponent(p)));
    if (Array.isArray(data.items)) {
      cart.length = 0;
      data.items.forEach(({ id, q }) => {
        const item = menuMap.get(id);
        if (item && q > 0) cart.push({ id, name: item.name, price: item.price, image: item.image, quantity: q });
      });
      renderCart();
      if (history.replaceState) history.replaceState(null, '', location.pathname);
      setTimeout(openCartModal, 0); // сразу показать корзину после восстановления
    }
  } catch {}
})();// === Scroll to Categories (стрелка наверх к чипам) ===
window.addEventListener('DOMContentLoaded', () => {
  const toTopBtn = document.getElementById('toTop');
  const catBar   = document.getElementById('categoryBar') || document.getElementById('menu');
  if (!toTopBtn || !catBar) return;

  let catY = 0;
  const recalcCatY = () => {
    const r = catBar.getBoundingClientRect();
    catY = r.top + window.pageYOffset;     // абсолютная Y-позиция блока категорий
  };
  recalcCatY();
  window.addEventListener('resize', recalcCatY);

  // Показываем кнопку, когда ушли ниже категорий
  const toggleToTop = () => {
    toTopBtn.classList.toggle('show', window.scrollY > catY + 40);
  };
  window.addEventListener('scroll', toggleToTop, { passive: true });
  toggleToTop();

  // Клик по стрелке — плавно к категориям
  toTopBtn.addEventListener('click', () => {
    // вариант 1 (предпочтительный): учитывает scroll-margin-top
    catBar.scrollIntoView({ behavior: 'smooth', block: 'start' });

    // вариант 2 (если захочешь фиксированный отступ):
    // window.scrollTo({ top: Math.max(0, catY - 8), behavior: 'smooth' });
  });
});

 </script>
 <button id="toTop" class="scroll-top" aria-label="Наверх" title="Наверх">
  <!-- стрелка ↑ -->
  <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M12 5l7 7-1.4 1.4L13 9.8V20h-2V9.8L6.4 13.4 5 12z"/>
  </svg>
</button>
</body> 
</html>
